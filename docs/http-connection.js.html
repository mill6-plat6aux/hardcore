

<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
      http-connection.js - Documentation
  </title>

  <link href="https://www.braintreepayments.com/images/favicon-ccda0b14.png" rel="icon" type="image/png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
  

  

  <!-- start Mixpanel -->
  <script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("1919205b2da72e4da3b9b6639b444d59");</script>
  <!-- end Mixpanel -->
</head>

<body>
  <svg style="display: none;">
    <defs>
      <symbol id="linkIcon" fill="#706d77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
      </symbol>
    </defs>
  </svg>

  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger" class="navicon-button x">
    <div class="navicon"></div>
  </label>

  <label for="nav-trigger" class="overlay"></label>

  <div class="top-nav-wrapper">
    <ul>
      <li >
        <a href="index.html">
          
            <svg fill="#6D6D6D" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
              <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
          
          
        </a>
      </li>

      

    </ul>
  </div>

  <nav>
    <h3 class="reference-title">
      Hardcore.js
    </h3>

    

    <h3>Classes</h3><ul><li id="Color-nav"><a href="Color.html">Color</a><ul class='methods'><li data-type="method" id="Color-colorWithAlpha-nav"><a href="Color.html#colorWithAlpha">colorWithAlpha</a></li><li data-type="method" id="Color-toString-nav"><a href="Color.html#toString">toString</a></li><li data-type="method" id="Color-toStringWithAlpha-nav"><a href="Color.html#toStringWithAlpha">toStringWithAlpha</a></li></ul></li><li id="FunctionalAnimation-nav"><a href="FunctionalAnimation.html">FunctionalAnimation</a><ul class='methods'><li data-type="method" id="FunctionalAnimation-finish-nav"><a href="FunctionalAnimation.html#finish">finish</a></li><li data-type="method" id="FunctionalAnimation-start-nav"><a href="FunctionalAnimation.html#start">start</a></li></ul></li><li id="Point-nav"><a href="Point.html">Point</a></li><li id="Polygon-nav"><a href="Polygon.html">Polygon</a><ul class='methods'><li data-type="method" id="Polygon-contains-nav"><a href="Polygon.html#contains">contains</a></li></ul></li><li id="PopoverViewController-nav"><a href="PopoverViewController.html">PopoverViewController</a><ul class='methods'><li data-type="method" id="PopoverViewController-dismiss-nav"><a href="PopoverViewController.html#dismiss">dismiss</a></li><li data-type="method" id="PopoverViewController-dismissView-nav"><a href="PopoverViewController.html#dismissView">dismissView</a></li><li data-type="method" id="PopoverViewController-reloadData-nav"><a href="PopoverViewController.html#reloadData">reloadData</a></li><li data-type="method" id="PopoverViewController-showView-nav"><a href="PopoverViewController.html#showView">showView</a></li></ul></li><li id="Rect-nav"><a href="Rect.html">Rect</a><ul class='methods'><li data-type="method" id="Rect-contains-nav"><a href="Rect.html#contains">contains</a></li><li data-type="method" id="Rect-intersect-nav"><a href="Rect.html#intersect">intersect</a></li></ul></li><li id="Size-nav"><a href="Size.html">Size</a></li><li id="SlideoverViewController-nav"><a href="SlideoverViewController.html">SlideoverViewController</a><ul class='methods'><li data-type="method" id="SlideoverViewController-dismiss-nav"><a href="SlideoverViewController.html#dismiss">dismiss</a></li><li data-type="method" id="SlideoverViewController-reloadData-nav"><a href="SlideoverViewController.html#reloadData">reloadData</a></li><li data-type="method" id="SlideoverViewController-showView-nav"><a href="SlideoverViewController.html#showView">showView</a></li></ul></li><li id="StyleAnimation-nav"><a href="StyleAnimation.html">StyleAnimation</a><ul class='methods'><li data-type="method" id="StyleAnimation-finish-nav"><a href="StyleAnimation.html#finish">finish</a></li><li data-type="method" id="StyleAnimation-start-nav"><a href="StyleAnimation.html#start">start</a></li></ul></li><li id="TextDrawingAttributes-nav"><a href="TextDrawingAttributes.html">TextDrawingAttributes</a></li><li id="ViewController-nav"><a href="ViewController.html">ViewController</a><ul class='methods'><li data-type="method" id="ViewController-reloadData-nav"><a href="ViewController.html#reloadData">reloadData</a></li><li data-type="method" id="ViewController-showView-nav"><a href="ViewController.html#showView">showView</a></li></ul></li></ul><h3 id="global-nav">Global</h3><ul><li><a href="global.html#Button">Button</a></li><li><a href="global.html#Canvas">Canvas</a></li><li><a href="global.html#Checkbox">Checkbox</a></li><li><a href="global.html#DateField">DateField</a></li><li><a href="global.html#FileSelector">FileSelector</a></li><li><a href="global.html#HtmlTag">HtmlTag</a></li><li><a href="global.html#InlineImage">InlineImage</a></li><li><a href="global.html#Input">Input</a></li><li><a href="global.html#InputComposite">InputComposite</a></li><li><a href="global.html#ListItem">ListItem</a></li><li><a href="global.html#MailField">MailField</a></li><li><a href="global.html#NumericField">NumericField</a></li><li><a href="global.html#OrderedList">OrderedList</a></li><li><a href="global.html#PasswordField">PasswordField</a></li><li><a href="global.html#ScrollView">ScrollView</a></li><li><a href="global.html#Select">Select</a></li><li><a href="global.html#Slider">Slider</a></li><li><a href="global.html#Table">Table</a></li><li><a href="global.html#TableBody">TableBody</a></li><li><a href="global.html#TableCell">TableCell</a></li><li><a href="global.html#TableHeader">TableHeader</a></li><li><a href="global.html#TableRow">TableRow</a></li><li><a href="global.html#TextArea">TextArea</a></li><li><a href="global.html#TextField">TextField</a></li><li><a href="global.html#TimeField">TimeField</a></li><li><a href="global.html#ToggleButton">ToggleButton</a></li><li><a href="global.html#UnorderedList">UnorderedList</a></li><li><a href="global.html#View">View</a></li></ul>
  </nav>

  <div id="main">
    
      <h1 class="page-title">
        http-connection.js
      </h1>
    

    
      

<section>
  <article>
    <pre class="prettyprint source linenums"><code>/*!
 * Hardcore.js
 * Copyright 2017-2021 Takuro Okada.
 * Released under the MIT License.
 */

/**
 * Provide HTTP connection method for standard web applications.
 * @namespace
 */
var HttpConnection = {

    /**
     * @type {string}
     */
    defaultCharacterSet: "utf-8",

    /**
     * @type {string}
     */
    defaultContentType: "application/json",

    /**
     * @type {string}
     */
    defaultMethod: "POST",

    /**
     * Default cache policy
     * @type {default|no-store|reload|no-cache|force-cache|only-if-cached}
     */
    defaultCachePolicy: "no-cache",

    /**
     * Default acccess policy
     * @type {same-origin|no-cors|cors|navigate}
     */
    defaultAccessPolicy: "same-origin",

    /**
     * Send a request to the specified URL.
     * @param {!string} path 
     * @param {?object|?FromData} request body data
     * @param {?string} contentType 
     * @param {?string} method HTTP method
     * @returns {!Promise} Receive the response data by Promise#then, and Promise#catch is called when a response other than HTTP status code 200 is received.
     */
    request: function(path, request, contentType, method) {
        var self = this;

        if(path == undefined || typeof path != "string") {
            console.error("The request path is not set.");
            return;
        }
        if(contentType == undefined &amp;&amp; !(request instanceof FormData)) {
            contentType = self.defaultContentType;
        }
        if(method == undefined) {
            method = self.defaultMethod;
        }

        if(request instanceof Array &amp;&amp; !Array.isArray(request)) {
            request = Array.from(request);
        }

        var _request = {
            method: method,
            cache: self.defaultCachePolicy,
            mode: self.defaultAccessPolicy,
            credentials: self.defaultAccessPolicy
        };
        if(request !== undefined) {
            if(contentType !== undefined) {
                if(contentType == "application/json" &amp;&amp; typeof request == "object") {
                    _request.body = JSON.stringify(request);
                }else {
                    _request.body = request;
                }
            }else {
                _request.body = request;
            }
        }
        if(contentType !== undefined) {
            _request.headers = { "Content-Type": contentType+"; charset="+self.defaultCharacterSet };
        }
        return fetch(path, _request).then(function(response) {
            if(response.redirected) {
                if(response.url != null) {
                    location.href = response.url;
                }
                return;
            }
            if(response.ok) {
                var contentType = response.headers.get("Content-Type");
                if(contentType != null) {
                    if(contentType == "application/json") {
                        return response.json();
                    }else if(contentType.startsWith("text")) {
                        return response.text();
                    }else {
                        return response.blob();
                    }
                }
            }else {
                return response.text().then(function(message) {
                    var responseBody = {
                        status: response.status,
                        responseText: message
                    };
                    self.handleServerError(responseBody);
                    return Promise.reject(responseBody);
                });
            }
        }, function(error) {
            var response = {};
            if(navigator.language != null &amp;&amp; navigator.language.includes("ja")) {
                response.responseText = "サーバに接続できません。ネットワークをご確認ください。";
            }else {
                response.responseText = "Unable to connect to the server. Please check your network.";
            }
            self.globalServerErrorHandler(response);
            return Promise.reject(response);
        });
    },

    /**
     * Common handling process for server errors. Displays a dialog by default.
     * @param {?object} response
     * @param {?number} response.statusCode
     * @param {?number} response.responseText
     */
    globalServerErrorHandler: function(response) {
        Controls.Message(response.responseText, "warning", function() {});
    },

    /**
     * @access private
     */
    handleServerError: function(response) {
        var message;
        // Bad Request
        if(response.status == 400) {
            this.globalServerErrorHandler(response);
        }
        // Forbidden
        else if(response.status == 403) {
            location.href = "";
        }
        // Payload Too Large
        else if(response.status == 413) {
            if(navigator.language != null &amp;&amp; navigator.language.includes("ja")) {
                message = "ファイルのサイズが大きすぎます。お手数ですがファイルを編集の上再度アクセスをお願いします。";
            }else {
                message = "The file is too large. Please edit the file and access it again.";
            }
            this.globalServerErrorHandler({statusCode: 413, responseText: message});
        }
        // Internal Server Error
        else if(response.status == 500) {
            if(navigator.language != null &amp;&amp; navigator.language.includes("ja")) {
                message = "サーバでエラーが発生しました。お手数ですが管理者にお問合せください。";
            }else {
                message = "An error has occurred on the server. Please contact the administrator for assistance.";
            }
            this.globalServerErrorHandler({statusCode: 500, responseText: message});
        }
        // Service Unavailable
        else if(response.status == 503) {
            if(navigator.language != null &amp;&amp; navigator.language.includes("ja")) {
                message =  "ただいまシステムが混み合っています。しばらく待ってから再度アクセスをお願いいたします。";
            }else {
                message = "The system is currently busy. Please wait for a while and access again.";
            }
            this.globalServerErrorHandler({statusCode: 503, responseText: message});
        }
    }
};
</code></pre>
  </article>
</section>

    


  </div>

  <br class="clear">

  <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.10</a>
  </footer>

  <script src="scripts/linenumber.js"></script>
  <script src="scripts/pagelocation.js"></script>

  

</body>
</html>
